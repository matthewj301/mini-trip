#############################################################################################################
### CONFIGURATION GENERATED BY THE RATOS CONFIGURATOR
### Everything below [include RatOS.cfg] will override default RatOS behavior
#############################################################################################################
[include RatOS.cfg]

#############################################################################################################
### MACRO CONFIGURATION
### Configure the behavior of RatOS macros
### See: https://os.ratrig.com/docs/configuration/macros
#############################################################################################################
[ratos]
allow_unsupported_slicer_versions: True

[gcode_macro RatOS]
variable_relative_extrusion: True
variable_force_absolute_position: False
variable_preheat_extruder: True

### BED MESH ###
variable_calibrate_bed_mesh: True
variable_adaptive_mesh: True


variable_resume_after_insert: False

variable_nozzle_priming: "primeblob"
variable_start_print_park_in: "front"
variable_start_print_park_z_height: 50
variable_end_print_park_in: "back"
variable_pause_print_park_in: "front"

variable_driver_type_x: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_driver_type_y: "tmc5160"              # tmc2209|tmc2130|tmc5160 = stepper driver type for sensorless homing
variable_sensorless_x_current: 0.82            # float = stepper driver run current for sensorless x-homing
variable_sensorless_y_current: 0.69            # float = stepper driver run current for sensorless y-homing

### SKEW ###
variable_skew_profile: "CaliLantern"
#############################################################################################################
### USER OVERRIDES & CUSTOM CONFIGURATION
### Anything custom you want to add, or RatOS configuration you want to override, do it here.
### This section is pre-populated with the most common settings you may want to change.
### See: https://os.ratrig.com/docs/configuration/includes-and-overrides
###
### It is recommended that you follow these steps to properly calibrate your printer:
### 0) Sanity check and PID Tuning: https://www.klipper3d.org/Config_checks.html
### 1) Z-offset calibration: https://www.klipper3d.org/Probe_Calibrate.html#calibrating-probe-z-offset
### 2) Pressure Advance: https://www.klipper3d.org/Pressure_Advance.html
### 3) Skew Correction: https://www.klipper3d.org/Skew_Correction.html
### 4) Resonance Compensation: https://www.klipper3d.org/Resonance_Compensation.html
### RatOS has dedicated macro's to generate shaper graphs for deeper analysis (requires accelerometer).
### Use MEASURE_COREXY_BELT_TENSION to compare tension between belts, and use
### GENERATE_SHAPER_GRAPHS to generate the resonance graphs for analysing and manually entering input shaper
### configuration.
### You can run SHAPER_CALIBRATE to automatically calibrate your input shaper configuration, if you just want
### to get started.
### Additionally, you can use the Realtime Analysis Tool to analyze your printer's performance in real-time.
### Read more about klipper here: https://www.klipper3d.org/Overview.html
#############################################################################################################

#---------------------------------------------------- X -----------------------------------------------------
# The A motor in the CoreXY system
#------------------------------------------------------------------------------------------------------------
[stepper_x]
dir_pin: x_dir_pin                 # Add ! in front of pin name to reverse the direction of stepper_x
rotation_distance: 40              # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: 0
position_max: 118
position_endstop: 118

#---------------------------------------------------- Y -----------------------------------------------------
# The B motor in the CoreXY system
#------------------------------------------------------------------------------------------------------------
[stepper_y]
dir_pin: y_dir_pin                 # Add ! in front of pin name to reverse the direction of stepper_y
rotation_distance: 40              # 40 for 20 tooth 2GT pulleys, 32 for 16 tooth 2GT pulleys
homing_speed: 50
position_min: 0
position_max: 118
position_endstop: 118

#---------------------------------------------------- Z -----------------------------------------------------
# The Z motor that moves the bed
#------------------------------------------------------------------------------------------------------------
[stepper_z]
dir_pin: !z0_dir_pin               # Remove ! in front of pin name to reverse the direction of stepper_z
rotation_distance: 8               # 4 for TR8*4 lead screws
homing_speed: 50
position_min: -10
position_max: 115

#------------------------------------------------- EXTRUDER -------------------------------------------------
# The extruder motor used for your toolhead
#------------------------------------------------------------------------------------------------------------
[extruder]
dir_pin: !toolboard_t0:PD1
#control: pid
#pid_kp: 21.673
#pid_ki: 1.338
#pid_kd: 87.776


[heater_bed]
#control: pid
#pid_kp: 68.203
#pid_ki: 2.842
#pid_kd: 409.216

# Probe configuration
[probe]
#z_offset: 0.0 # Will be commented out after a successful PROBE_CALIBRATE and SAVE_CONFIG
pin: ^toolboard_t0:probe_pin# For NPN NC probes such as the Super Pinda / Vinda / SupCR / Decoprobe probes.
#pin: ^!toolboard_t0:probe_pin # NPN NO (refer to the specs of your probe)
#pin: toolboard_t0:probe_pin # PNP NO (refer to the specs of your probe)
#pin: !toolboard_t0:probe_pin # PNP NC (refer to the specs of your probe)

# REMEMBER TO TUNE SENSORLESS HOMING BEFORE ATTEMPTING TO PRINT!
# You'll find instructions in the generated sensorless-homing-*.cfg file(s),
# where you should keep your sensorless homing settings.

#------------------------------------------------- OVERRIDES -------------------------------------------------
# 
#------------------------------------------------------------------------------------------------------------

[include custom/toolheads/rapidburner.cfg]
[include custom/hotends/tk.cfg]

[include custom/printers/tri-zero/tri-zero.cfg]
[include custom/fans/controller_fans.cfg]
[include custom/fans/aux_fans.cfg]
[include custom/tuning/*.cfg]
[include custom/macros.cfg]


[resonance_tester]
accel_per_hz: 100
sweeping_accel: 400
sweeping_period: 0

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 16.929
#*# pid_ki = 0.795
#*# pid_kd = 90.154
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 72.068
#*# pid_ki = 1.430
#*# pid_kd = 908.054
#*#
#*# [probe]
#*# z_offset = 10.629
#*#
#*# [bed_mesh ratos]
#*# version = 1
#*# points =
#*# 	  -0.024151, -0.026495, -0.012432
#*# 	  -0.031182, 0.000068, 0.027412
#*# 	  -0.056182, -0.029620, 0.004755
#*# x_count = 3
#*# y_count = 3
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = lagrange
#*# tension = 0.2
#*# min_x = 23.9277
#*# max_x = 96.2277
#*# min_y = 23.8386
#*# max_y = 96.1386
#*#
#*# [input_shaper]
#*# shaper_type_x = mzv
#*# shaper_freq_x = 77.2
#*# shaper_type_y = ei
#*# shaper_freq_y = 73.6
#*#
#*# [skew_correction CaliFlower]
#*# xy_skew = -0.00040056106636879665
#*# xz_skew = 0.0
#*# yz_skew = 0.0
#*#
#*# [skew_correction CaliLantern]
#*# xy_skew = -0.000770745899567306
#*# xz_skew = -0.00040305056457107306
#*# yz_skew = 0.003365847167825502
